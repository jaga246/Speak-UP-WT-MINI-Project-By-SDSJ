<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SpeakUp Portal</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <script type="text/javascript"
        src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js">
</script>
<script type="text/javascript">
   (function(){
      emailjs.init({
        publicKey: "Bik0tSPgVFlJ14wiH",
      });
   })();
</script>
    <style>
        body {
            background-color: #eef2f3;
            font-family: Arial, sans-serif;
        }
        .navbar {
            background-color: #002855;
        }
        .navbar-dark .navbar-nav .nav-link {
            color: white;
        }
        .container-main {
            display: flex;
            justify-content: center;
            margin-top: 80px;
        }
        .left-section {
            background-color: #cce0ff;
            padding: 20px;
            border-radius: 5px;
            max-width: 45%;
        }
        .right-section {
            background-color: white;
            padding: 20px;
            border-radius: 5px;
            max-width: 45%;
        }
        .form-control {
            margin-bottom: 10px;
        }
        .footer {
            text-align: center;
            margin-top: 20px;
            padding: 10px;
            background-color: #cce0ff;
            font-size: 14px;
        }
        .btn-primary {
            background-color: #002855;
            border: none;
        }
        .btn-primary:hover {
            background-color: #004080;
        }
    </style>
</head>
<body>

    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-dark fixed-top">
        <a class="navbar-brand" href="#">SpeakUp Portal</a>
    </nav>

    <!-- Main Content -->
    <div class="container container-main">
        <!-- Left Section: Information -->
        <div class="left-section">
            <h4>Welcome to the SpeakUp Portal</h4>
            <p>
                The SpeakUp portal provides an independent, confidential platform 
                for reporting concerns. Reports are handled with integrity to ensure
                appropriate action is taken.
            </p>
            <p><strong>Examples of concerns to report:</strong></p>
            <ul>
                <li>Illegal activities</li>
                <li>Health and safety risks</li>
                <li>Fraud or misconduct</li>
                <li>Sexual harassment or abuse</li>
                <li>Environmental damage</li>
                <li>Other unethical behavior</li>
            </ul>
        </div>

        <!-- Right Section: Report Form -->
        <div class="right-section">
            <h4>Create a Report</h4>
            <form id="reportForm">
                <input type="text" id="name" class="form-control" placeholder="Your Name">
                    <input type="text" id="area" class="form-control" placeholder="Area">
                    <input type="text" id="mandal" class="form-control" placeholder="Mandal">

                    <div class="form-group">
                        <label>Gender:</label><br>
                        <input type="radio" name="gender" id="male" value="Male">
                        <label for="male">Male</label>
                        <input type="radio" name="gender" id="female" value="Female">
                        <label for="female">Female</label>
                        <input type="radio" name="gender" id="other" value="Other">
                        <label for="other">Other</label>
                    </div>
                <div class="form-group">
                    <input type="checkbox" id="shareInfo">
                    <label for="shareInfo">Allow sharing my details</label>
                </div>
                

                <h5>Details of Incident</h5>
                <select class="form-control" id="incidentType">
                    <option>Conduct which is an offense or breach of law</option>
                    <option>Failure to comply with legal obligations</option>
                    <option>Health and safety risks</option>
                    <option>Fraud or misconduct</option>
                    <option>Other unethical conduct</option>
                </select>
                <textarea id="incidentDesc" class="form-control" rows="3" placeholder="Describe the incident"></textarea>
                <input type="text" class="form-control" placeholder="When did it happen?" id="incidentDate">
                <select id="office" class="form-control">
                    <option>Select the office</option>
                    <option>MRO office</option>
                    <option>VRO office</option>
                    <option>Municiplaity office</option>
                    <option>sachivalayam</option>
                    <option>Education Ministry</option>
                </select>
                <h5>Were there any witnesses?</h5>
                <div>
                    <input type="radio" name="witness" id="yes" value="Yes">
                    <label for="yes">Yes</label>
                    <input type="radio" name="witness" id="no" value="No">
                    <label for="no">No</label>
                </div>
                
                <button type="submit" class="btn btn-primary btn-block mt-3">Send Report</button>
            </form>
        </div>
    </div>
    <!-- Report Submission Modal -->
    <div class="modal fade" id="reportModal" tabindex="-1" role="dialog" aria-labelledby="reportModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="reportModalLabel">Report Status</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body" id="reportModalBody">
          <!-- Message goes here dynamically -->
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" onclick="window.location.reload()">Report Again</button>
          <button type="button" class="btn btn-primary" onclick="window.location.href='index.html'">Home</button>
        </div>
      </div>
    </div>
  </div>
    

    <!-- Footer -->
    <div class="footer">
        <p>Â© 2025 SpeakUp Portal. All rights reserved.</p>
    </div>

    <script>
        flatpickr("#incidentDate", {
          dateFormat: "Y-m-d",
          maxDate: "today"
        });
    </script>
</body>
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-app.js";
  import { getFirestore, collection, addDoc , doc , setDoc , getDoc } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-firestore.js";
  import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-auth.js";

  // Your Firebase config (you said it's configured, but ensure this is present)
  const firebaseConfig = {
    apiKey: "AIzaSyBAQdZ46Zab_zTZTkeTG97HpPzmIDqDuHE",
  authDomain: "speakupportal.firebaseapp.com",
  projectId: "speakupportal",
  storageBucket: "speakupportal.firebasestorage.app",
  messagingSenderId: "1017841133120",
  appId: "1:1017841133120:web:47380e98faad1c1e3021a5"
  };

  // Initialize Firebase
  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db = getFirestore(app);
  

window.addEventListener('DOMContentLoaded', function () {
const form = document.getElementById("reportForm");
if (form) {
  form.addEventListener("submit", function (e) {
    e.preventDefault();

    const name = document.getElementById("name").value;
    const area = document.getElementById("area").value;
    const mandal = document.getElementById("mandal").value;
    const gender = document.querySelector('input[name="gender"]:checked')?.value || "";
    const shareInfo = document.getElementById("shareInfo").checked;
    const incidentType = document.getElementById("incidentType").value;
    const incidentDesc = document.getElementById("incidentDesc").value;
    const incidentDate = document.getElementById("incidentDate").value;
    const description = document.querySelector('textarea').value;
    const office = document.getElementById("office").value;
    const witness = document.querySelector('input[name="witness"]:checked')?.value || "";

    if (!name || !area || !mandal || !gender || !incidentDesc || !incidentDate || office === "Select the office" || !witness) {
    document.getElementById("reportModalLabel").innerText = "Incomplete Submission";
    document.getElementById("reportModalBody").innerText = "Please fill all required fields.";
    $('#reportModal').modal('show');
    return;
  }

    onAuthStateChanged(auth, async (user) => {
    if (user) {
      const uid = user.uid;
      try {
        await addDoc(collection(db, "reports", uid, "userReports"), {
            name,
            area,
            mandal,
            gender,
            shareInfo,
            incidentType,
            description,
            incidentDate,
            office,
            witness,
            createdAt: new Date()
        });
        form.reset();
        document.getElementById("reportModalLabel").innerText = "Report Submitted";
        document.getElementById("reportModalBody").innerText = "Your report has been submitted successfully.";
        $('#reportModal').modal('show');
    
      }catch (error) {
        console.error("Error saving profile:", error);
        document.getElementById("reportModalLabel").innerText = "Submission Failed";
        document.getElementById("reportModalBody").innerText = "Something went wrong. Please try again.";
        $('#reportModal').modal('show');
      }
    } else {
      window.location.href = "login.html" ;
    }
  });
  const emailParams = {
  to_email: "jagadeshmukkara@gmail.com",
  from_name: name || "Anonymous",
  area,
  mandal,
  gender,
  shareInfo: shareInfo ? "Yes" : "No",
  incidentType,
  description,
  incidentDate,
  office,
  witness
};

emailjs.send("service_speakup", "template_zt6dlpd", emailParams)
  .then(function(response) {
    console.log("Email sent!", response.status, response.text);
  }, function(error) {
    console.error("Email failed:", error);
  });

  });
}
});
  </script>
</html>
